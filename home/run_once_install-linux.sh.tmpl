#!/bin/sh
set -e

if [ "{{ .chezmoi.os }}" != "linux" ]; then
  exit 0
fi

if ! command -v apt-get >/dev/null 2>&1; then
  echo "apt-get is required but not installed." >&2
  exit 1
fi

sudo apt-get update
if ! command -v curl >/dev/null 2>&1; then
  sudo apt-get install -y curl
fi

if apt-cache show zoxide >/dev/null 2>&1; then
  sudo apt-get install -y zoxide
else
  echo "zoxide package not found via apt-get." >&2
  exit 1
fi

if apt-cache show eza >/dev/null 2>&1; then
  sudo apt-get install -y eza
else
  echo "eza package not found via apt-get." >&2
  exit 1
fi

if ! command -v starship >/dev/null 2>&1; then
  curl -fsSL https://starship.rs/install.sh | sh -s -- -y
fi

if ! command -v zoxide >/dev/null 2>&1; then
  curl -fsSL https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | sh
fi

if [ -d "$HOME/.antidote/.git" ]; then
  git -C "$HOME/.antidote" pull --ff-only
elif [ ! -d "$HOME/.antidote" ]; then
  git clone https://github.com/mattmc3/antidote.git "$HOME/.antidote"
fi
